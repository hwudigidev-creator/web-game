# DDT Web Game

交互式網頁遊戲專案

**版本**: v0.6.0（右下角顯示，由 package.json 自動注入）

## 技術棧

- **遊戲框架**: Phaser 3.80.0 (Arcade Physics)
- **語言**: TypeScript 5.2.2
- **構建工具**: Vite 5.0.0
- **模組系統**: ES Module
- **PWA**: 支援手機安裝為 App
- **字型**: Google Fonts - Noto Sans TC（思源黑體）

## 專案結構

```
src/
├── config/                 # 配置文件
│   ├── gridText.json           # 網格文字配置
│   └── pixelFont.json          # 像素字體定義 (A-Z, 0-9)
├── scenes/                 # Phaser 場景
│   ├── BootScene.ts            # 啟動場景
│   ├── GridScene.ts            # 網格過渡動畫場景
│   └── MainScene.ts            # 主遊戲場景
├── systems/                # 遊戲系統
│   ├── SkillSystem.ts          # 技能系統
│   └── MonsterSystem.ts        # 怪物系統
├── utils/                  # 工具函數
│   └── TextToGrid.ts           # 文字轉網格座標轉換器
└── main.ts                 # 應用入口點
public/
├── manifest.json           # PWA 配置
├── sw.js                   # Service Worker（快取）
├── background.png          # 背景圖片
├── audio/                  # 背景音樂
│   ├── BGM00.mp3               # 標題畫面音樂
│   ├── BGM01.mp3               # 遊戲音樂 1
│   └── BGM02.mp3               # 遊戲音樂 2
├── icons/                  # PWA 圖示
│   ├── icon.png                # 原始圖示
│   ├── icon-72x72.png          # 72x72
│   ├── icon-96x96.png          # 96x96
│   ├── icon-128x128.png        # 128x128
│   ├── icon-144x144.png        # 144x144
│   ├── icon-152x152.png        # 152x152
│   ├── icon-192x192.png        # 192x192
│   ├── icon-384x384.png        # 384x384
│   └── icon-512x512.png        # 512x512
├── sprites/
│   └── character/          # 角色動畫序列圖
│       ├── IDEL01.png          # 待機 1
│       ├── IDEL02.png          # 待機 2
│       ├── RUN01.png           # 跑步 1
│       ├── RUN02.png           # 跑步 2
│       ├── ATTACK01.png        # 攻擊 1
│       ├── ATTACK02.png        # 攻擊 2
│       └── HURT01.png          # 受傷
└── icons/skills/           # 技能圖示
    ├── A00.png ~ A05.png       # 靈魂渲染（動畫大師）Lv.0~5
    ├── B00.png ~ B05.png       # 疾光狙擊（超級導演）Lv.0~5
    ├── C00.png ~ C05.png       # 咒言幻象（遊戲先知）Lv.0~5
    ├── P01.png                 # 鈦金屬賽博肝臟（固定）
    ├── P02.png                 # 精神同步率強化（固定）
    ├── P03.png                 # 視網膜增強模組（固定）
    └── P04.png                 # AI賦能強化（固定）
scripts/
└── generate-icons.mjs      # PWA 圖示生成腳本
```

## PWA 支援

遊戲支援 Progressive Web App，可安裝至手機主畫面：

- **App 名稱**: DIGI WAR
- **顯示模式**: 全螢幕（fullscreen）
- **方向**: 橫向（landscape）
- **快取策略**: Network First（優先網路，離線時使用快取）

### 安裝方式

- **Android Chrome**: 選單 → 「新增至主畫面」
- **iOS Safari**: 分享 → 「加入主畫面」

### 圖示生成

```bash
# 安裝依賴
npm install

# 將原始圖示放置於 public/icons/icon.png
# 執行生成腳本
node scripts/generate-icons.mjs
```

## 核心場景

### GridScene (網格過渡場景)

- 網格洪水填充進場動畫
- 圓形揭露 (Reveal Mask) 退出動畫
- 燃燒效果轉場 (白 → 黃 → 橘 → 紅 → 消失)
- Loading 進度顯示
- 像素字體文字渲染
- 游標互動光暈效果
- 標題 BGM 播放（BGM00，循環）

### BootScene (啟動場景)

- 過渡佔位場景
- 為資源預載預留

### MainScene (主遊戲場景)

- **地圖系統**: 10 倍大地圖，相機追蹤，30% 死區
- **角色系統**: Sprite 動畫（待機、跑步、攻擊、受傷），大小為遊戲區域 15%
- **角色控制**: 點擊/長按移動、WASD 鍵盤移動，基礎速度每秒 3 單位
- **技能欄**: 4 個主動技能 + 3 個被動技能（8x8 網格圖示），未取得為實心、取得後為空心
- **HP 條**: 網格式暗紅暗紫流動漸層（3 排），顯示 當前(+護盾)/最大 HP，損傷白色區塊 1 秒後靠攏
- **護盾條**: 金色至白金色流動漸層（2 排），覆蓋於 HP 條上面 2 排
- **經驗條**: 網格式藍紫流動漸層動畫效果
- **技能選擇面板**: 升級時彈出，A/S/D 選擇、重複按同一鍵確認（手機版隱藏按鍵提示），自動調整文字大小避免溢出
- **技能資訊窗格**: 點擊技能欄圖示可查看詳細數值，3 秒後自動隱藏
- **技能圖示**: 各技能獨立圖示，主動技能隨等級變換（A/B/C 系列），被動技能固定圖示（P 系列）
- **CUT IN 系統**: 技能升級時顯示角色對話，達到 MAX 時顯示額外能力效果說明
- **怪物系統**: 自動生成、追蹤玩家、造成傷害、血量隨等級成長
- **遊戲 BGM**: BGM01/02 隨機播放，播完自動切換
- **RWD 最小字級**: 大字 14px、中字 12px、小字 10px（確保手機可讀性）

## 角色動畫

| 狀態 | 動畫 | 幀數 | FPS |
|------|------|------|-----|
| 待機 (idle) | char_idle | 2 | 2 |
| 跑步 (run) | char_run | 2 | 8 |
| 攻擊 (attack) | char_attack | 2 | 8 |
| 受傷 (hurt) | char_hurt | 1 | 2 |

## 傷害單位系統

- **1 傷害單位** = 10 點傷害
- **1 範圍單位** = 畫面高度 10%

## HP 系統

- **基礎 HP**: 200
- **每級成長**: +50 HP
- **升級時**: 自動回滿 HP
- **HP 條**: 網格式設計，使用頂部 3 行格子（row 1-3）
- **HP 顯示**: `當前HP(+護盾值) / 最大HP`，護盾值為金色
- **受傷效果**: 角色閃淡紅白（80% 覆蓋）、HP 低於 30% 畫面邊緣紅暈閃爍

## 護盾系統

- **來源**: 架構師技能
- **護盾值**: 最大 HP 的 30%
- **霸體效果**: 護盾存在時受傷不會進入硬直狀態，可持續移動
- **效果**: 優先吸收傷害、反傷攻擊者
- **護盾破碎回血**: 護盾被打破時，恢復初始護盾等值的 HP
- **視覺**: 金色至白金色流動漸層（2 排），覆蓋於 HP 條上面 2 排（row 1-2），受擊金色閃光

## 怪物系統

- **生成**: 每 2 秒從畫面外 3 個方向（上/左/右）隨機生成
- **生成數量**: 每 5 級多生成 1 隻怪物
- **移動**: 持續朝玩家位置移動，速度每秒 1 單位
- **外觀**: 網格式 Q 彈史萊姆，底部平坦，8% 左右擠壓動畫
- **攻擊**: 進入玩家 1 單位範圍內，每 3 秒造成傷害
- **傷害**: 玩家等級 × 1 傷害單位（最低 1 單位）
- **血量成長**: 每級 +10%
- **碰撞判定**: 考慮怪物體型半徑（體型 8%，碰撞半徑 4%）
- **受傷閃爍**: 白紅交替閃爍 300ms
- **死亡特效**: 周邊 3 個隨機圓形擴散淡出（半徑 3~5 格）
- **受傷硬直**: 玩家受傷後 200ms 無法移動
- **畫面震動**: 一次擊中 10 隻以上怪物時輕微震動

### 怪物種類

| 怪物 | 顏色 | 大小 | 速度 | 傷害 | 備註 |
|------|------|------|------|------|------|
| 史萊姆 | 淺藍色 | 5% | 1x | 1x | 基礎怪物 |
| BOSS 史萊姆 | 深紫色 | 15% | 0.6x | 3x | 每 10 級出現，HP = 基礎 × 成長^等級 × 等級 |
| 蝙蝠群 | 深紫色 | 2.5% | 2x | 1x | 8 隻一組，從對角線衝入畫面 |

## 技能系統

### 技能類型

| 類型 | 數量 | 欄位位置 |
|------|------|----------|
| 攻擊型 (Active) | 4 個 | 左側 4 格 |
| 被動型 (Passive) | 3 個 | 右側 3 格 |

### 技能欄設計

- **圖示大小**: 8x8 網格格子
- **技能間隔**: 1 格
- **群組間隔**: 2 格（主動與被動之間）
- **CD 視覺化**: 邊框從 12 點鐘方向順時針旋轉顯示冷卻進度
- **邊框顏色**: 黑色 50% 透明度（冷卻中）、技能色 40% 透明度（就緒）

### 技能等級

- 等級範圍: 0 - 5（共 6 級）
- Lv.0 起即有效果
- 等級 5 顯示為 "MAX"
- 未擁有技能顯示為空
- **滿等所需等級**: 7 技能 × 6 級 = 42 級
- **技能全滿後**: 可繼續升級獲得 HP 成長，不再顯示技能選擇面板

### 技能選擇機制

- 第一次升級：只顯示 3 個攻擊技能（確保有傷害手段）
- 之後每次升級顯示 3 個選項: **2 攻擊 + 1 被動**
- 被動技能欄位上限 3 個，滿了只能升級已有技能
- 只有未滿級 (< MAX) 的技能會被隨機挑選
- 所有技能滿級後不再顯示選擇面板

### 攻擊技能

| 技能名稱 | 副標題 | 顏色 | 基礎冷卻 | 效果 |
|----------|--------|------|----------|------|
| 靈魂渲染 | 動畫大師 | 藍色 | 1 秒 | 扇形攻擊，3 單位範圍，每級 +10° 角度 +1 傷害（Lv.0=60°/2u, MAX=110°/7u）|
| 咒言幻象 | 遊戲先知 | 紫色 | 1.5 秒 | 圓形範圍攻擊，每級 +0.5 範圍 +1 傷害（Lv.0=2u/1u, MAX=4.5u/6u）|
| 疾光狙擊 | 超級導演 | 綠色 | 2.5 秒 | 貫穿光束，10 單位範圍，每級 +1 道光束 +1 傷害（Lv.0=1道/1u, MAX=6道/6u）|
| 靈魂統領 | 架構師 | 金色 | 10 秒 | 護盾（最大 HP 30%，霸體）+ 反傷，每級 +1.5 反傷（Lv.0=1u, MAX=8.5u），護盾破碎回血 |

- 技能自動發動（冷卻結束即發動）
- 發動時角色播放攻擊動畫 150ms 並閃爍對應顏色

### 技能特效視覺

- **扇形/圓形**: 中心淡（15%）、邊緣亮（75%），smoothstep 曲線平滑過渡
- **光束**: 中心亮（70%）、邊緣暗（20%），頭尾 15% 幾近透明
- **邊緣線**: 分段繪製，頭尾漸淡（15% 幾近透明）
- **明度**: 中心壓暗（50%），邊緣保持原色（100%）

### 被動技能

| 技能名稱 | 顏色 | 效果 | Lv.0 | Lv.5 (MAX) |
|----------|------|------|------|------------|
| 鈦金屬賽博肝臟 | 銀灰色 | 每級 +10% HP，每 15 秒回復 1% 最大 HP（每級 -1 秒） | 10% / 15s | 60% / 10s |
| 精神同步率強化 | 暗橘色 | 每級 +10% 移速、-8% 冷卻 | 10% / 8% | 60% / 48% |
| 視網膜增強模組 | 暗紅色 | 每級 +30% 經驗 | 30% | 180% |
| AI賦能強化 | 灰藍色 | 每級 +25% 攻擊、+15% 防禦（直接減少受到傷害） | 25% / 15% | 150% / 90% |

### MAX 後額外能力

技能達到 MAX 後解鎖額外能力，隨玩家等級自動提升（技能滿級後立即生效）：

| 技能名稱 | 額外能力 | 效果 | 每級成長 |
|----------|----------|------|----------|
| 靈魂渲染 | 穿透 | 攻擊後發射扇形波（每 0.3 秒傷害一次） | +0.7%/級 |
| 咒言幻象 | 爆發 | 擊殺時從該位置再發動（可連鎖） | +1%/級 |
| 疾光狙擊 | 連鎖 | 擊中時產生 X 型射線（長度減半） | +0.05%/級 |
| 靈魂統領 | 堅守 | 護盾覆蓋時向外炸開 3 單位並回血 | +1%/級 |
| 鈦金屬賽博肝臟 | 不死 | 抵銷一次死亡，觸發暗影爆炸（CUT IN 訊息） | 固定 1 次 |
| 精神同步率強化 | 迅捷 | 閃避機率 | +0.2%/級 |
| 視網膜增強模組 | 洞察 | 暴擊率 | +0.5%/級 |
| AI賦能強化 | 超載 | 暴擊傷害加成 | +0.5%/級 |

- 點擊技能欄圖示可查看當前額外能力數值
- 額外能力效果會自動計算並顯示在技能資訊面板

## 音樂系統

- **標題畫面**: BGM00 循環播放
- **遊戲畫面**: BGM01/02 隨機播放，播完自動切換另一首
- **預設音量**: 50%

## UI 控制列

右上角控制列（轉場完成後顯示）：

- **重新開始按鈕**: 點擊重新載入遊戲
- **網格倍率控制**: 調整網格精細度（1X 粗、2X 中、3X 細），電腦預設 3X、手機預設 2X
- **全螢幕按鈕**: 點擊切換全螢幕模式（手機版隱藏）
- **音量控制**: 直式排列，+/- 按鈕搭配 10 格音量指示條（支援長按），預設 50%

## 視覺特效

### 網格系統

- 全畫面網格用於技能特效顯示
- HP 條、護盾條、經驗條使用網格式流動漸層
- 技能欄圖示為 8x8 網格設計
- 怪物使用網格繪製（與技能特效同倍率）

### 擊中特效

- **十字高光**: 擊中位置顯示白色十字（臂長 3 格）
- **旋轉消散**: 邊擴散邊隨機旋轉 20~50 度淡出
- **方向隨機**: 50% 順時針 / 50% 逆時針

### 畫面邊緣特效

- 橢圓形暗角（vignette）效果
- 2 倍半徑中空區域
- 跳過頂部 4 行（row 0-3，邊框 + HP/護盾條）和底部 3 行（避免遮擋 UI）

### 低血量警示

- HP 低於 30% 時畫面邊緣紅暈閃爍

## 測試用快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| **Shift + Backspace** | 切換網格技能特效（預設關閉以提升效能）|
| **+** | 增加 10 經驗（按住連續觸發）|
| **-** | 減少 10 經驗（按住連續觸發）|
| **Shift + +** | 直接升 1 級 |
| **Shift + 0** | 跳到 42 級，所有技能滿等 |
| **Ctrl + Shift + F5** | 靈魂渲染（動畫大師）MAX |
| **Ctrl + Shift + F6** | 遊戲先知（編碼者）MAX |
| **Ctrl + Shift + F7** | 超級導演（視效師）MAX |
| **Ctrl + Shift + F8** | 靈魂統領（架構師）MAX |
| **Ctrl + Shift + F9** | 鈦金屬賽博肝臟 MAX |
| **Ctrl + Shift + F10** | 精神同步率強化 MAX |
| **Ctrl + Shift + F11** | 視網膜增強模組 MAX |
| **Ctrl + Shift + F12** | AI賦能強化 MAX |

> 個別技能快捷鍵條件：技能未滿級，被動技能需欄位有空位

## 架構設計

### 響應式設計

- 基準寬度: 1920px
- 遊戲區域: 16:9 比例，置中顯示
- 所有元素動態縮放適配
- 使用 `dvh` 單位排除手機瀏覽器網址列
- 使用 `visualViewport` API 監聽視窗變化

### 手機支援

- 強制橫向模式（直向時顯示旋轉提示）
- 全螢幕 API 支援（含各瀏覽器前綴）
- 禁用觸控長按選單
- 長按移動支援
- PWA 安裝支援

### 容器層級

```
uiContainer (固定 UI)
├── HP 條（網格式）
├── 護盾條（覆蓋層）
├── 技能欄圖標（8x8 網格）
├── 經驗條（網格式）
├── 技能選擇面板
├── 技能資訊窗格
└── 低血量紅暈效果

skillGridContainer (技能特效網格)
├── 扇形特效格子
├── 圓形特效格子
└── 光束特效格子

gameAreaContainer
├── boundsBorder (遊戲區域邊框)
└── worldContainer (隨相機移動)
    ├── floorGrid (格子背景)
    ├── character (Sprite 角色)
    └── monsters (怪物)
```

### 場景通信

- 使用 Phaser Registry 存儲全局狀態
- `reveal-update` 事件: GridScene → MainScene 同步揭露遮罩
- `reveal-complete` 事件: 過渡完成通知
- `volumechange` 自訂事件: HTML → 遊戲音量同步

## 開發命令

```bash
# 安裝依賴
npm install

# 啟動開發伺服器
npm run dev

# TypeScript 檢查 + 構建
npm run build

# 本地預覽構建結果
npm run preview

# 代碼檢查
npm run lint

# 生成 PWA 圖示
node scripts/generate-icons.mjs
```

## 構建配置

- **Base URL**: `/www/` (GitHub Pages)
- **Phaser 獨立打包**: 優化加載性能
- **資源不內聯**: 確保以文件形式加載

## 待開發功能

- [x] 技能實際效果（傷害怪物）
- [x] 怪物死亡和經驗掉落
- [x] PWA 支援（手機安裝）
- [x] 技能資訊窗格
- [x] 怪物網格式渲染（Q 彈史萊姆）
- [x] 怪物體型碰撞判定
- [x] 怪物死亡擴散特效
- [x] 擊中旋轉消散特效
- [x] BOSS 怪物系統（每 10 級）
- [x] 蝙蝠群怪物（對角線衝入）
- [x] 技能特效固定位置（不隨玩家移動）
- [x] PWA 自動版本更新
- [x] 技能圖示系統（隨等級變換）
- [x] CUT IN 系統（升級對話、MAX 能力說明、觸發訊息）
- [x] Google Fonts 字型優化（Noto Sans TC）
- [ ] 遊戲結束畫面
- [ ] 本地存檔機制
- [ ] 更多怪物類型
