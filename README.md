# DDT Web Game

交互式網頁遊戲專案

**版本**: v0.9.11a（右下角顯示，由 package.json 自動注入）

## 技術棧

- **遊戲框架**: Phaser 3.80.0 (Arcade Physics)
- **語言**: TypeScript 5.2.2
- **構建工具**: Vite 5.0.0
- **模組系統**: ES Module
- **PWA**: 支援手機安裝為 App
- **字型**: Google Fonts - Noto Sans TC（思源黑體）

## 專案結構

```
src/
├── config/                 # 配置文件
│   ├── gridText.json           # 網格文字配置（標題畫面）
│   └── pixelFont.json          # 像素字體定義 (完整 A-Z, 0-9, %, 空格)
├── scenes/                 # Phaser 場景
│   ├── BootScene.ts            # 啟動場景
│   ├── GridScene.ts            # 網格過渡動畫場景
│   └── MainScene.ts            # 主遊戲場景
├── systems/                # 遊戲系統
│   ├── SkillSystem.ts          # 技能系統
│   └── MonsterSystem.ts        # 怪物系統
├── utils/                  # 工具函數
│   └── TextToGrid.ts           # 文字轉網格座標轉換器
└── main.ts                 # 應用入口點
public/
├── manifest.json           # PWA 配置
├── sw.js                   # Service Worker（快取）
├── background.png          # 背景圖片
├── cube.png                # 標題畫面 Cube 圖片
├── NeroS.png               # 標題畫面 NeroS 角色圖片
├── glow.png                # 標題畫面紫色光暈圖片
├── audio/                  # 背景音樂
│   ├── BGM00.mp3               # 標題畫面音樂
│   ├── BGM01.mp3               # 遊戲音樂 1
│   └── BGM02.mp3               # 遊戲音樂 2
├── icons/                  # PWA 圖示
│   ├── icon.png                # 原始圖示
│   ├── icon-72x72.png          # 72x72
│   ├── icon-96x96.png          # 96x96
│   ├── icon-128x128.png        # 128x128
│   ├── icon-144x144.png        # 144x144
│   ├── icon-152x152.png        # 152x152
│   ├── icon-192x192.png        # 192x192
│   ├── icon-384x384.png        # 384x384
│   └── icon-512x512.png        # 512x512
├── sprites/
│   └── character/          # 角色動畫序列圖
│       ├── IDEL01.png          # 待機 1
│       ├── IDEL02.png          # 待機 2
│       ├── RUN01.png           # 跑步 1
│       ├── RUN02.png           # 跑步 2
│       ├── ATTACK01.png        # 攻擊 1
│       ├── ATTACK02.png        # 攻擊 2
│       └── HURT01.png          # 受傷
├── effects/hex/            # Hex 背景字元圖片
│   └── 0.png ~ F.png           # 16 進制字元（白色，用 tint 染色）
└── icons/skills/           # 技能圖示
    ├── A00.png ~ A05.png       # 靈魂渲染（動畫大師）Lv.0~5
    ├── B00.png ~ B05.png       # 疾光狙擊（超級導演）Lv.0~5
    ├── C00.png ~ C05.png       # 咒言幻象（遊戲先知）Lv.0~5
    ├── D00.png ~ D05.png       # 靈魂統領（架構師）Lv.0~5
    ├── P01.png                 # 鈦金屬賽博肝臟（固定）
    ├── P02.png                 # 精神同步率強化（固定）
    ├── P03.png                 # 視網膜增強模組（固定）
    ├── P04.png                 # AI賦能強化（固定）
    ├── SA0.png                 # 燃燒的賽璐珞（固定）
    ├── SA1.png                 # 靈魂三向斬（固定）
    ├── SB0.png                 # 完美像素審判（固定）
    ├── SB1.png                 # 爆發的影視特效（固定）
    ├── SC0.png                 # 技術美術大神（固定）
    ├── SC1.png                 # 幻影迭代模式（固定）
    ├── SD0.png                 # 絕對邏輯防禦（固定）
    └── SD1.png                 # 零信任防禦協定（固定）
scripts/
└── generate-icons.mjs      # PWA 圖示生成腳本
```

## PWA 支援

遊戲支援 Progressive Web App，可安裝至手機主畫面：

- **App 名稱**: DIGI WAR
- **顯示模式**: 全螢幕（fullscreen）
- **方向**: 橫向（landscape）
- **快取策略**: Network First（優先網路，離線時使用快取）

### 安裝方式

- **Android Chrome**: 選單 → 「新增至主畫面」
- **iOS Safari**: 分享 → 「加入主畫面」

### 圖示生成

```bash
# 安裝依賴
npm install

# 將原始圖示放置於 public/icons/icon.png
# 執行生成腳本
node scripts/generate-icons.mjs
```

## 核心場景

### GridScene (網格過渡場景)

- 網格洪水填充進場動畫
- 圓形揭露 (Reveal Mask) 退出動畫
- 燃燒效果轉場 (白 → 黃 → 橘 → 紅 → 消失)
- 兩階段 Loading：啟動時載入基礎資源，點擊開始後載入遊戲資源
- 進度條視覺化：全寬 3 行高進度條（左右各留 2 格）
- 像素字體文字渲染（完整 A-Z、0-9 字元）
- 標題畫面：雙行文字「PRESS TO」「STARE INTO THE VOID」
- 游標互動光暈效果
- 標題 BGM 播放（BGM00，循環）
- **標題畫面視覺效果**：
  - NeroS 角色圖片（右側，150% 畫面高度，75% 亮度，1.5% 呼吸動畫）
  - Cube 圖片（左側，70% 畫面高度，3% 呼吸動畫 + 2% 飄動）
  - 紫色光暈圖片（200% 畫面高度，不規則電流閃爍效果）
  - 背景壓暗（50% 亮度）

### BootScene (啟動場景)

- 過渡佔位場景
- 為資源預載預留

### MainScene (主遊戲場景)

- **地圖系統**: 10 倍大地圖，相機追蹤，30% 死區
- **角色系統**: Sprite 動畫（待機、跑步、攻擊、受傷），大小為遊戲區域 15%
- **角色控制**: 點擊/長按移動、WASD 鍵盤移動，基礎速度每秒 3 單位
- **技能欄**: 4 個主動技能 + 3 個被動技能（8x8 網格圖示），未取得為實心、取得後為空心
- **HP 條**: 網格式暗紅暗紫流動漸層（3 排），顯示 當前(+護盾)/最大 HP，損傷白色區塊 1 秒後靠攏
- **護盾條**: 金色至白金色流動漸層（2 排），覆蓋於 HP 條上面 2 排
- **經驗條**: 網格式藍紫流動漸層動畫效果
- **技能選擇面板**: 升級時彈出，A/S/D 選擇、重複按同一鍵確認（手機版隱藏按鍵提示），自動調整文字大小避免溢出
- **技能資訊窗格**: 點擊技能欄圖示可查看詳細數值，3 秒後自動隱藏
- **技能圖示**: 各技能獨立圖示，主動技能隨等級變換（A/B/C/D 系列），被動技能固定圖示（P 系列），組合技固定圖示（SA/SB/SC/SD 系列）
- **CUT IN 系統**: 技能升級時顯示角色對話，達到 MAX 時顯示額外能力效果說明
- **怪物系統**: 自動生成、追蹤玩家、造成傷害、血量隨等級成長
- **遊戲 BGM**: BGM01/02 隨機播放，播完自動切換
- **RWD 最小字級**: 大字 14px、中字 12px、小字 10px（確保手機可讀性）
- **Hex 背景系統**: 地板隨機生成二進制/十六進制字元，協助空間定位

### Hex 背景系統規格

| 項目 | 規格 |
|------|------|
| **圖片規格** | 80x80px，字體 70px，5px padding，平行四邊形傾斜 |
| **顏色控制** | 白色圖片 + tint 染色（正常：`0x1a5a1a` 暗綠，高亮：`0xffffff` 白） |
| **字元選擇** | 30% 十六進制（0-9, A-F）、70% 二進制（0, 1） |
| **淡入時間** | 1-2 秒隨機 |
| **存活時間** | 1-3 秒隨機（完全顯現後計算） |
| **物件池** | Sprite 物件池管理，最多 500 個 |

### 圓形擴散系統

| 項目 | 規格 |
|------|------|
| **觸發間隔** | 每 5 秒 |
| **起點數量** | 5 個隨機位置 |
| **擴散範圍** | 4-10 單位（1 單位 = 10% 畫面高度） |
| **擴散速度** | 40-100ms 每環隨機 |
| **緩衝區** | 畫面外 20% 避免切割線 |

### 掃光效果

| 類型 | 間隔 | 方向 | 寬度 | 速度 |
|------|------|------|------|------|
| **橫向掃光** | 30 秒 | 左→右 | 15% 畫面寬 | 30%/秒 |
| **圓形掃光** | 10 秒 | 角色→外 | 10% 畫面高 | 80%/秒 |

- 掃光經過時 tint 漸變為白色高亮

## 角色動畫

| 狀態 | 動畫 | 幀數 | FPS |
|------|------|------|-----|
| 待機 (idle) | char_idle | 2 | 2 |
| 跑步 (run) | char_run | 2 | 8 |
| 攻擊 (attack) | char_attack | 2 | 8 |
| 受傷 (hurt) | char_hurt | 1 | 2 |

## 傷害單位系統

- **1 傷害單位** = 10 點傷害
- **1 範圍單位** = 畫面高度 10%

## HP 系統

- **基礎 HP**: 200
- **每級成長**: +50 HP
- **升級時**: 自動回滿 HP
- **HP 條**: 網格式設計，使用頂部 3 行格子（row 1-3）
- **HP 顯示**: `當前HP(+護盾值) / 最大HP`，護盾值為金色
- **受傷效果**: 角色閃淡紅白（80% 覆蓋）、HP 低於 30% 畫面邊緣紅暈閃爍

## 護盾系統

- **來源**: 架構師技能
- **護盾值**: 最大 HP 的 30%
- **霸體效果**: 護盾存在時受傷不會進入硬直狀態，可持續移動
- **效果**: 優先吸收傷害、反傷攻擊者
- **護盾破碎回血**: 護盾被打破時，恢復初始護盾等值的 HP
- **視覺**: 金色至白金色流動漸層（2 排），覆蓋於 HP 條上面 2 排（row 1-2），受擊金色閃光

## 怪物系統

- **生成**: 每 2 秒從畫面外 3 個方向（上/左/右）隨機生成
- **生成數量**: 每 5 級多生成 1 隻怪物，70 級後固定 15 隻
- **70 級後強化**: 每 5 級怪物血量和傷害 +10%
- **移動**: 持續朝玩家位置移動，速度每秒 1 單位
- **外觀**: 網格式 Q 彈史萊姆，底部平坦，8% 左右擠壓動畫
- **攻擊**: 進入玩家 1 單位範圍內，每 3 秒造成傷害
- **傷害**: 玩家等級 × 1 傷害單位（最低 1 單位）× 強化倍率
- **血量成長**: 每級 +10% × 強化倍率
- **碰撞判定**: 考慮怪物體型半徑（體型 8%，碰撞半徑 4%）
- **受傷閃爍**: 白紅交替閃爍 300ms
- **死亡特效**: 周邊 3 個隨機圓形擴散淡出（半徑 3~5 格）
- **受傷硬直**: 玩家受傷後 200ms 無法移動
- **畫面震動**: 一次擊中 10 隻以上怪物時輕微震動

### 怪物種類

| 怪物 | 顏色 | 大小 | 速度 | 傷害 | 備註 |
|------|------|------|------|------|------|
| 史萊姆 | 淺綠色 | 5% | 1.8x | 1x | 基礎怪物 |
| 菁英史萊姆 | 暗紫色 | 15% | 1x | 3x | 每 10 級出現，HP = 基礎 × 3，死亡掉落血球 |
| 蝙蝠群 | 紫色 | 2.5% | 8x | 0.5x | 8 隻一組，從對角線衝入畫面 |

### 掉落系統

| 掉落物 | 來源 | 效果 | 數量 | 備註 |
|--------|------|------|------|------|
| 血球 | 菁英怪 | 回復 10% 最大 HP | 2-3 個 | 粉紫色愛心，永久存在直到拾取 |

- **拾取範圍**: 基礎 1 單位 + 視網膜增強模組加成（每級 +0.5 單位）
- **散落範圍**: 死亡位置 0.5 單位內隨機分布
- **事件驅動**: 掉落由怪物系統自動觸發，易於擴展新掉落物

## 技能系統

### 技能類型

| 類型 | 數量 | 欄位位置 |
|------|------|----------|
| 攻擊型 (Active) | 4 個 | 左側 4 格 |
| 被動型 (Passive) | 3 個 | 右側 3 格 |

### 技能欄設計

- **圖示大小**: 8x8 網格格子
- **技能間隔**: 1 格
- **群組間隔**: 2 格（主動與被動之間）
- **CD 視覺化**: 邊框從 12 點鐘方向順時針旋轉顯示冷卻進度
- **邊框顏色**: 黑色 50% 透明度（冷卻中）、技能色 40% 透明度（就緒）

### 技能等級

- 等級範圍: 0 - 5（共 6 級）
- Lv.0 起即有效果
- 等級 5 顯示為 "MAX"
- 未擁有技能顯示為空
- **滿等所需等級**: 7 技能 × 6 級 = 42 級
- **技能全滿後**: 可繼續升級獲得 HP 成長，不再顯示技能選擇面板

### 技能選擇機制

- 第一次升級：只顯示 3 個攻擊技能（確保有傷害手段）
- 之後每次升級顯示 3 個選項: **2 攻擊 + 1 被動**
- 被動技能欄位上限 3 個，滿了只能升級已有技能
- 只有未滿級 (< MAX) 的技能會被隨機挑選
- 所有技能滿級後不再顯示選擇面板

### 攻擊技能

> 技能自動發動（冷卻結束即發動），發動時角色播放攻擊動畫 150ms 並閃爍對應顏色

#### 靈魂渲染（動畫大師）
- **顏色**: 藍色 `0x6699ff` | **冷卻**: 1 秒 | **範圍**: 3 單位扇形

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | 60° 扇形、2 傷害 | 你練習了繪畫技法，動畫美術的能力提升了 |
| Lv.1 | 70° 扇形、3 傷害 | 你習得了分鏡設計，並獲得了動態腳本製作技術 |
| Lv.2 | 80° 扇形、4 傷害 | 你增進了手繪動畫和停格動畫的製作技術 |
| Lv.3 | 90° 扇形、5 傷害 | 你苦練了3D角色模型和3D場景的設計 |
| Lv.4 | 100° 扇形、6 傷害 | 你完全理解了動畫法則，提升了角色動畫的製作精度 |
| MAX | 3 向衝擊波（以最近敵人為基準 +0°/+120°/+240°）、10 傷害、10 單位射程 | 你成為了動畫大師，解鎖了進階技能組合 |

- **MAX 額外能力「三向衝擊」**: 改為 3 向衝擊波飛行 10 單位消失

#### 咒言幻象（遊戲先知）
- **顏色**: 紫色 `0xaa66ff` | **冷卻**: 2 秒 | **範圍**: 圓形

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | 3 單位範圍、2 傷害 | 你參透了互動設計的原理，同時了解遊戲企劃架構 |
| Lv.1 | 3.5 單位範圍、4 傷害 | 你習得動作捕捉的技術，將應用到虛擬實境製作 |
| Lv.2 | 4 單位範圍、6 傷害 | 你增進了程式設計能力和遊戲引擎的創作能力 |
| Lv.3 | 4.5 單位範圍、8 傷害 | 你整合了虛擬網紅製作技術，讓自媒體營銷具爆發力 |
| Lv.4 | 5 單位範圍、10 傷害 | 你導入了人工智慧協作能力，產能提升了數倍 |
| MAX | 5.5 單位範圍、12 傷害 | 你成為了遊戲先知，解鎖了進階技能組合 |

- **MAX 額外能力「爆發」**: 擊殺時從該位置再發動（可連鎖），機率 +1%/級

#### 疾光狙擊（超級導演）
- **顏色**: 綠色 `0x66ff66` | **冷卻**: 2.5 秒 | **範圍**: 10 單位貫穿

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | 1 道光束、1 傷害 | 你研究了影像美學，劇本編導的能力提升了 |
| Lv.1 | 2 道光束、2 傷害 | 你習得了動靜態攝影的能力，獲得了畫面控制的技術 |
| Lv.2 | 3 道光束、3 傷害 | 你增進了影片剪輯和動態影像的設計能力 |
| Lv.3 | 4 道光束、4 傷害 | 你苦練了數位成音技術影像獲得更多回饋 |
| Lv.4 | 5 道光束、5 傷害 | 你學會應用特效合成後製提升了影像各種可能性 |
| MAX | 3 道精準鎖定超粗射線、6 傷害、15 單位射程 | 你成為了超級導演，解鎖了進階技能組合 |

- **MAX 額外能力「精準」**: 改為 3 條精準鎖定超粗射線，射程 15 單位

#### 靈魂統領（架構師）
- **顏色**: 金色 `0xffcc00` | **冷卻**: 10 秒 | **效果**: 30% HP 護盾（霸體）+ 反傷

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | 30% HP 護盾、2 反傷 | 你開始學習系統架構，建立了基礎的防禦機制 |
| Lv.1 | 30% HP 護盾、4 反傷 | 你理解了模組化設計，防禦層級變得更有條理 |
| Lv.2 | 30% HP 護盾、6 反傷 | 你掌握了負載平衡，系統承受能力大幅提升 |
| Lv.3 | 30% HP 護盾、8 反傷 | 你建構了冗餘備援，任何攻擊都能被有效分散 |
| Lv.4 | 30% HP 護盾、10 反傷 | 你精通了高可用架構，防禦系統近乎無懈可擊 |
| MAX | 30% HP 護盾、20 反傷＋擊退 | 你成為了頂尖架構師，解鎖了進階技能組合 |

- **MAX 額外能力「八角爆盾」**: 冷卻刷新時護盾殘值×10 傷害、4 單位範圍金色八角盾爆炸並擊退

### 技能特效視覺

- **扇形/圓形**: 中心淡（15%）、邊緣亮（75%），smoothstep 曲線平滑過渡
- **光束**: 中心亮（70%）、邊緣暗（20%），頭尾 15% 幾近透明
- **邊緣線**: 分段繪製，頭尾漸淡（15% 幾近透明）
- **明度**: 中心壓暗（50%），邊緣保持原色（100%）

### 被動技能

> 被動技能自動生效，點擊技能欄圖示可查看當前額外能力數值，MAX 額外能力隨玩家等級自動提升

#### 鈦金屬賽博肝臟（超級肝）
- **顏色**: 銀灰色 `0xaabbcc`

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | +10% HP、每 15 秒回血 | 驚人無懈可擊的耐力，你的工作時長不斷提升 |
| Lv.1 | +20% HP、每 14 秒回血 | 驚人無懈可擊的耐力，你的工作時長不斷提升 |
| Lv.2 | +30% HP、每 13 秒回血 | 驚人無懈可擊的耐力，你的工作時長不斷提升 |
| Lv.3 | +40% HP、每 12 秒回血 | 驚人無懈可擊的耐力，你的工作時長不斷提升 |
| Lv.4 | +50% HP、每 11 秒回血 | 驚人無懈可擊的耐力，你的工作時長不斷提升 |
| MAX | +60% HP、每 10 秒回血 | 千錘百鍊的鈦金肝再也不怕熬夜 |

- **MAX 額外能力「不死」**: 抵銷一次死亡，觸發暗影爆炸

#### 精神同步率強化（零的領域）
- **顏色**: 暗橘色 `0xdd8844`

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | +10% 移速、-8% 冷卻 | 進入到心流狀態，專注力提升且變的敏捷 |
| Lv.1 | +20% 移速、-16% 冷卻 | 進入到心流狀態，專注力提升且變的敏捷 |
| Lv.2 | +30% 移速、-24% 冷卻 | 進入到心流狀態，專注力提升且變的敏捷 |
| Lv.3 | +40% 移速、-32% 冷卻 | 進入到心流狀態，專注力提升且變的敏捷 |
| Lv.4 | +50% 移速、-40% 冷卻 | 進入到心流狀態，專注力提升且變的敏捷 |
| MAX | +60% 移速、-48% 冷卻 | 你已進入無限心流狀態，感覺身手異常敏捷迅速 |

- **MAX 額外能力「迅捷」**: 閃避機率 +0.2%/級

#### 視網膜增強模組（血輪眼）
- **顏色**: 暗紅色 `0x992233`

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | +0.5 單位拾取範圍 | 敏銳的觀察力，視野範圍擴大了 |
| Lv.1 | +1 單位拾取範圍 | 敏銳的觀察力，視野範圍擴大了 |
| Lv.2 | +1.5 單位拾取範圍 | 敏銳的觀察力，視野範圍擴大了 |
| Lv.3 | +2 單位拾取範圍 | 敏銳的觀察力，視野範圍擴大了 |
| Lv.4 | +2.5 單位拾取範圍 | 敏銳的觀察力，視野範圍擴大了 |
| MAX | +3 單位拾取範圍 | 千錘百鍊的敏銳觀察，再沒什麼看不穿、看不清 |

- **MAX 額外能力「洞察」**: 暴擊率 +0.5%/級

#### AI賦能強化（智能輔助）
- **顏色**: 灰藍色 `0x6688aa`

| 等級 | 效果 | 升級說明 |
|------|------|----------|
| Lv.0 | +25% 攻擊、+15% 防禦 | 攻守兼備，各方面能力全面提升 |
| Lv.1 | +50% 攻擊、+30% 防禦 | 攻守兼備，各方面能力全面提升 |
| Lv.2 | +75% 攻擊、+45% 防禦 | 攻守兼備，各方面能力全面提升 |
| Lv.3 | +100% 攻擊、+60% 防禦 | 攻守兼備，各方面能力全面提升 |
| Lv.4 | +125% 攻擊、+75% 防禦 | 攻守兼備，各方面能力全面提升 |
| MAX | +150% 攻擊、+90% 防禦 | 熟練的AI操作，讓你無論做任何事情效率提高數十倍 |

- **MAX 額外能力「超載」**: 暴擊傷害 +0.5%/級

### 進階技能系統

當玩家持有特定基礎技能組合時，可在技能選擇時看到進階技能選項。進階技能等級無上限，可持續升級。

#### 技能選擇邏輯
- 優先顯示一般技能（2 主動 + 1 被動）
- 若一般技能選項不足 3 個，用可解鎖的進階技能填補空位
- 進階技能卡片有金色邊框和「ADVANCED」標籤

#### 進階技能列表

| 技能名稱 | 組合需求 | 冷卻 | 效果 |
|----------|----------|------|------|
| 燃燒的賽璐珞 | 靈魂渲染（動畫大師）+ 鈦金屬賽博肝臟 | 2 秒 | 消耗 10 HP，以角色為中心旋轉一圈 30° 扇形攻擊（3 單位範圍），傷害 = (角色等級 + 技能等級) 單位 |
| 技術美術大神 | 咒言幻象（遊戲先知）+ 視網膜增強模組 | 1 秒 | 在角色周圍 5 單位隨機地點射下光線，3 單位爆炸範圍，命中敵人暈眩 1 秒，傷害 = (角色等級 + 技能等級) 單位 |
| 絕對邏輯防禦 | 靈魂統領（架構師）+ 精神同步率強化 | 持續 | 有護盾時產生輪鋸繞角色旋轉（基礎 3 個，每 10 級 +1 個，最多 6 個），撞敵消耗護盾 |
| 完美像素審判 | 疾光狙擊（超級導演）+ 視網膜增強模組 | 3 秒 | 繪製青綠色井字線，4 個焦點隨機順序爆炸（3 單位範圍），命中敵人暈眩 1 秒 |
| 爆發的影視特效 | 疾光狙擊（超級導演）+ AI 賦能強化 | 3.5 秒 | 發射 20 枚追蹤導彈，隨機方向飛出 2 單位後直衝最近敵人，3 單位爆炸範圍 |
| 幻影迭代模式 | 咒言幻象（遊戲先知）+ AI 賦能強化 | 8 秒 | 召喚最多 3 隻分身（3-5 單位距離跟隨），每 5 秒嘲諷 2 秒（白紅閃爍），每秒施放隨機進階技能，滿 3 隻後發射曲線追蹤咒言圓圈（0.5→4 單位），切換技能時分身咒言爆炸（2 單位傷害） |
| 零信任防禦協定 | 靈魂統領（架構師）+ AI 賦能強化 | 持續 | 展開 5 單位八角矩陣，光束鎖定敵人時逐秒加粗並提升傷害，範圍內敵人移動速度減半 |

#### 進階技能組合說明

| 技能名稱 | 組合來源 | 設計概念 |
|----------|----------|----------|
| 燃燒的賽璐珞 | 扇形攻擊 + HP 強化 | 動畫師燃燒生命創作，扇形旋轉如逐幀繪製動畫 |
| 技術美術大神 | 圓形範圍 + 暴擊強化 | 全能開發者天降神兵，精準打擊並暈眩敵人 |
| 絕對邏輯防禦 | 護盾技能 + 移速強化 | 架構師的防禦邏輯化為實體輪鋸，技能等級越高輪鋸越多 |
| 完美像素審判 | 光束攻擊 + 暴擊強化 | 導演的精準構圖，青綠色井字線定位爆破目標並暈眩敵人 |
| 爆發的影視特效 | 光束攻擊 + 攻擊強化 | 導演的華麗特效，追蹤導彈群飛射擊 |
| 幻影迭代模式 | 圓形範圍 + 攻擊強化 | 先知的分身術，AI 複製體週期嘲諷並施放技能，滿員時發射追蹤咒言 |
| 零信任防禦協定 | 護盾技能 + 攻擊強化 | 架構師的安全協定，八角矩陣掃描並減速敵人 |

#### 進階技能 CUT IN

| 技能名稱 | CUT IN 訊息 |
|----------|-------------|
| 燃燒的賽璐珞 | 「你選擇成為傳統手繪動畫師、逐幀動畫師」 |
| 技術美術大神 | 「左手寫 Code，右手畫圖，一人成軍的遊戲開發者」 |
| 絕對邏輯防禦 | 「系統架構固若金湯，邏輯防線無懈可擊」 |
| 完美像素審判 | 「每一個像素都是精心計算的結果」 |
| 爆發的影視特效 | 「這就是好萊塢等級的視覺饗宴！」 |
| 幻影迭代模式 | 「AI 分身，無限迭代，版本控制的極致」 |
| 零信任防禦協定 | 「驗證一切，信任歸零，這才是真正的安全」 |

#### 絕對邏輯防禦詳細機制

| 項目 | 規格 |
|------|------|
| **輪鋸數量** | 基礎 3 個 + floor(技能等級 / 10)，最多 6 個 |
| **滿員等級** | 技能等級 30（3 + 30/10 = 6 個） |
| **護盾消耗** | 每撞擊敵人 1 次消耗 2% 護盾 |
| **消耗遞減** | 滿 6 個後，每升 1 級減少 0.1% 消耗（30 級 = 2%，40 級 = 1%） |
| **護盾回復** | 消耗率降至 0% 以下時，撞敵反而回復護盾 |
| **旋轉軌道** | 2 單位距離繞角色旋轉 |
| **旋轉週期** | 2 秒一圈 |
| **輪鋸範圍** | 0.5 單位 |

#### 零信任防禦協定詳細機制

| 項目 | 規格 |
|------|------|
| **八角矩陣** | 5 單位範圍掃描敵人 |
| **減速效果** | 範圍內敵人移動速度減半 |
| **光束鎖定** | 持續照射同一敵人時累計鎖定時間 |
| **光束加粗** | 每鎖定 1 秒，光束寬度 ×2（1x → 2x → 3x...） |
| **傷害加成** | 每鎖定 1 秒，傷害 + 技能等級 %（例：10 級時 +10%/秒） |
| **目標切換** | 換目標時重置鎖定時間和光束倍率 |

### 怪物暈眩系統

- 部分進階技能可使怪物進入暈眩/癱瘓狀態
- 暈眩中的怪物停止移動和攻擊
- 暈眩時間可疊加（取較長的結束時間）
- **視覺效果**: 暈眩中的怪物顏色變灰白、Q 彈動畫暫停
- **觸發技能**: 技術美術大神（1 秒）、完美像素審判（1 秒）

### 世界單位系統

遊戲內所有距離使用統一的世界單位：

- **1 單位** = 畫面高度 10%
- **距離計算**: `distUnits = distPixels / unitSize`
- **怪物半徑**: `monsterRadiusUnits = size * 0.5`
- 所有技能範圍、爆炸半徑、碰撞偵測皆使用世界單位

## 音樂系統

- **標題畫面**: BGM00 循環播放
- **遊戲畫面**: BGM01/02 隨機播放，播完自動切換另一首
- **預設音量**: 50%

## UI 控制列

左上角控制列（轉場完成後顯示）：

- **回首頁按鈕**: Font Awesome 房屋圖示，連結至官網首頁
- **聯繫我們按鈕**: Font Awesome 信封圖示，連結至聯繫頁面
- **分享按鈕**: Font Awesome 分享圖示，使用 Web Share API（手機）或複製連結（桌面）

右上角控制列（轉場完成後顯示）：

- **重新開始按鈕**: 點擊重新載入遊戲
- **網格倍率控制**: 調整網格精細度（1X 粗、2X 中、3X 細），電腦預設 3X、手機預設 2X
- **全螢幕按鈕**: 點擊切換全螢幕模式（手機版隱藏）
- **音量控制**: 直式排列，+/- 按鈕搭配 10 格音量指示條（支援長按），預設 50%

## 視覺特效

### 網格系統

- 全畫面網格用於技能特效顯示
- HP 條、護盾條、經驗條使用網格式流動漸層
- 技能欄圖示為 8x8 網格設計
- 怪物使用網格繪製（與技能特效同倍率）

### 擊中特效

- **十字高光**: 擊中位置顯示白色十字（臂長 3 格）
- **旋轉消散**: 邊擴散邊隨機旋轉 20~50 度淡出
- **方向隨機**: 50% 順時針 / 50% 逆時針

### 畫面邊緣特效

- 橢圓形暗角（vignette）效果
- 2 倍半徑中空區域
- 跳過頂部 4 行（row 0-3，邊框 + HP/護盾條）和底部 3 行（避免遮擋 UI）

### 低血量警示

- HP 低於 30% 時畫面邊緣紅暈閃爍

## 測試用快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| **Shift + Backspace** | 切換網格技能特效（預設關閉以提升效能）|
| **+** | 增加 10 經驗（按住連續觸發）|
| **-** | 減少 10 經驗（按住連續觸發）|
| **Shift + +** | 直接升 1 級 |
| **Shift + 0** | 跳到 42 級，所有技能滿等 |
| **Ctrl + Shift + F5** | 靈魂渲染（動畫大師）MAX |
| **Ctrl + Shift + F6** | 遊戲先知（編碼者）MAX |
| **Ctrl + Shift + F7** | 超級導演（視效師）MAX |
| **Ctrl + Shift + F8** | 靈魂統領（架構師）MAX |
| **Ctrl + Shift + F9** | 鈦金屬賽博肝臟 MAX |
| **Ctrl + Shift + F10** | 精神同步率強化 MAX |
| **Ctrl + Shift + F11** | 視網膜增強模組 MAX |
| **Ctrl + Shift + F12** | AI賦能強化 MAX |

> 個別技能快捷鍵條件：技能未滿級，被動技能需欄位有空位

## 架構設計

### 響應式設計

- 基準寬度: 1920px
- 遊戲區域: 16:9 比例，置中顯示
- 所有元素動態縮放適配
- 使用 `dvh` 單位排除手機瀏覽器網址列
- 使用 `visualViewport` API 監聽視窗變化

### 手機支援

- 強制橫向模式（直向時顯示旋轉提示）
- 全螢幕 API 支援（含各瀏覽器前綴）
- 禁用觸控長按選單
- 長按移動支援
- PWA 安裝支援

### 容器層級

```
uiContainer (固定 UI)
├── HP 條（網格式）
├── 護盾條（覆蓋層）
├── 技能欄圖標（8x8 網格）
├── 經驗條（網格式）
├── 技能選擇面板
├── 技能資訊窗格
└── 低血量紅暈效果

skillGridContainer (技能特效網格)
├── 扇形特效格子
├── 圓形特效格子
└── 光束特效格子

gameAreaContainer
├── boundsBorder (遊戲區域邊框)
└── worldContainer (隨相機移動)
    ├── floorGrid (格子背景)
    ├── character (Sprite 角色)
    └── monsters (怪物)
```

### 場景通信

- 使用 Phaser Registry 存儲全局狀態
- `reveal-update` 事件: GridScene → MainScene 同步揭露遮罩
- `reveal-complete` 事件: 過渡完成通知
- `volumechange` 自訂事件: HTML → 遊戲音量同步

## 開發命令

```bash
# 安裝依賴
npm install

# 啟動開發伺服器
npm run dev

# TypeScript 檢查 + 構建
npm run build

# 本地預覽構建結果
npm run preview

# 代碼檢查
npm run lint

# 生成 PWA 圖示
node scripts/generate-icons.mjs
```

## 構建配置

- **Base URL**: `/www/` (GitHub Pages)
- **Phaser 獨立打包**: 優化加載性能
- **資源不內聯**: 確保以文件形式加載

## 待開發功能

- [x] 技能實際效果（傷害怪物）
- [x] 怪物死亡和經驗掉落
- [x] PWA 支援（手機安裝）
- [x] 技能資訊窗格
- [x] 怪物網格式渲染（Q 彈史萊姆）
- [x] 怪物體型碰撞判定
- [x] 怪物死亡擴散特效
- [x] 擊中旋轉消散特效
- [x] 菁英怪物系統（每 10 級，掉落血球）
- [x] 蝙蝠群怪物（對角線衝入）
- [x] 掉落系統（事件驅動，易擴展）
- [x] 技能特效固定位置（不隨玩家移動）
- [x] PWA 自動版本更新
- [x] 技能圖示系統（隨等級變換）
- [x] CUT IN 系統（升級對話、MAX 能力說明、觸發訊息）
- [x] Google Fonts 字型優化（Noto Sans TC）
- [x] 進階技能系統（組合解鎖、無限升級）
- [x] 怪物暈眩系統（癱瘓效果）
- [x] 標題畫面視覺強化（NeroS、Cube、光暈動畫）
- [ ] 遊戲結束畫面
- [ ] 本地存檔機制
- [ ] 更多怪物類型
