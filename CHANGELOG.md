# 更新紀錄

## v0.8.11a - 護盾特效重構與零信任重新設計

### 護盾特效系統

#### 持續護盾光環
- 腳底橢圓改用 `sector_360` 紋理壓扁（scaleY = scaleX * 0.35）
- 金色半透明效果，跟隨角色移動
- 護盾消失時自動隱藏

#### 上升光粒子（LINE 紋理）
- 從 fillRect 方塊改為 LINE 紋理物件池
- 寬度：24-40px，起始長度 0.2 單位
- 上升距離：1.2 單位，拉長至 0.6 單位
- 高速上升 + 拉長 + 淡出動畫

#### 護盾發動/爆炸特效
- 粒子寬度：20-36px
- 上升高度：2.0-3.5 單位
- 起始 Y 隨機錯開（修正一橫排問題）
- 拉長效果 2.5 倍

### 零信任防禦協定重構

#### 8 光點系統
- 8 個光點在領域的 8 個角
- 使用 `sector_360` 橢圓壓扁（參考護盾橢圓再小一半）
- 每個光點有向上垂直射線（裝飾用，金白閃爍）

#### 智能追蹤
- 敵人進入範圍：光點追向最近的未被追蹤怪物
- 目標死亡/離開：光點找下一個最近敵人或回到角落
- 移動速度：每秒 8 單位
- 移動範圍限制：不超出 8 角矩陣半徑

#### 顏色變化
- 平時（待機）：白色閃爍
- 追蹤敵人時：紅色閃爍

#### 傷害機制
- 傷害間隔：0.5 秒（原 0.2 秒）
- 1 單位傷害範圍
- 同樣的 8 角擴散爆炸效果

### 程式碼清理
- 移除 `_drawShieldActivateEffect` 舊函式
- 移除 `_flashShieldEffect` 舊函式
- 移除 `zeroTrustBeams` 改用 `zeroTrustPoints`

---

## v0.8.10a - 一般技能火花效果與程式碼清理

### 視覺效果

#### 一般主動技能打擊火花
- **靈魂渲染**：藍色（0x6699ff）打擊火花，4 條，方向性反彈
- **咒言幻象**：紫色（0xaa66ff）爆炸火花，360° 圓形擴散
- **疾光狙擊**：綠色（0x66ff66）打擊火花，5 條，光束方向反彈
- **靈魂統領護盾爆炸**：金色（0xffcc00）打擊火花，8 條，隨機方向（類似輪鋸）

#### 火花數量可調整
- `showHitSparkEffect` 新增 `count` 參數
- 進階技能使用 8 條（預設）
- 一般技能使用 4-5 條（較輕量）

### 程式碼清理

#### 移除舊版網格十字特效
- 移除 `flashWhiteCrossAt` 函數
- 移除 `flashCritCrossAt` 函數
- 移除 `flashWhiteCrossAtPositions` 函數
- 移除 `flashCritCrossAtPositions` 函數
- 清理約 250 行重複程式碼

---

## v0.8.9a - 特效系統完善與隨機性強化

### 特效系統

#### 兩種標準化火花效果
- **打擊火花** `showHitSparkEffect`：方向性反彈，線條從撞擊點向反彈方向飛出
- **爆炸火花** `showExplosionSparkEffect`：360度發散，線條從中心向外均勻飛散

#### 線條起點修正
- 修正 LINE 紋理中心點計算錯誤
- 線條尾端正確對齊撞擊點/爆炸中心
- 解決線條「反噴」交叉問題

#### 爆炸範圍擊中效果
- 技術美術大神：被炸到的怪物噴出紫色爆炸火花
- 完美像素審判：被炸到的怪物噴出青綠色爆炸火花
- 導彈爆炸：被炸到的怪物噴出橘色爆炸火花

### 隨機性強化

#### 火花參數隨機化
- 長度：0.6~1.4 倍隨機變化
- 寬度：0.7~1.3 倍隨機變化
- 角度抖動：打擊 ±14°、爆炸 ±17°
- 橫向偏移：打擊效果額外 ±0.15 單位隨機
- 飛行距離：打擊 1.2~2.5 單位、爆炸 0.9~1.4 倍
- 持續時間：打擊 280~420ms、爆炸 250~350ms

---

## v0.8.8a - 打擊火花效果標準化

### 性能優化

#### LINE 紋理物件池
- 新增 LINE 紋理專用物件池（80 個 sprites）
- 打擊火花效果使用物件池，避免頻繁創建/銷毀
- 線條動畫完成後自動回收到池中重複使用

### 視覺效果

#### 打擊火花效果標準化
- 新增 `showHitSparkEffect` 統一函數處理所有技能打擊效果
- 支援兩種模式：方向反彈模式、隨機散射模式
- 標準規格：8 條線條、長度 1.8 單位、寬度 36px、持續 350ms
- 反彈散射角度 ±30 度
- 起點往攻擊方向退後 0.5 單位，橫向隨機散佈防止交叉

#### 技能專屬打擊特效
- 燃燒的賽璐珞：藍色（0x4488ff）火花，靈魂渲染系
- 技術美術大神：紫色（0x9966ff）火花，方向反彈
- 次元向量疾劃：紅色（0xff4466）火花，方向反彈
- 輪鋸系列：金色（0xffcc00）火花，隨機散射
- 零信任防禦：金色/橘色火花，方向反彈

### 程式碼優化

#### 重複程式碼清理
- 移除各技能的獨立打擊效果程式碼
- 統一使用 `showHitSparkEffect` 函數
- 減少約 200 行重複程式碼

---

## v0.8.7a - 技能單位系統統一與暈眩修正

### 系統改進

#### 世界單位系統統一
- 所有技能距離比較統一使用世界單位（1 單位 = 10% 畫面高度）
- `distUnits = distPixels / unitSize` 統一轉換公式
- `monsterRadiusUnits = monster.definition.size * 0.5` 統一怪物半徑計算
- 修正多處單位混用導致的技能判定問題

#### 暈眩系統修正
- 修正暈眩順序：先暈眩再造成傷害（避免怪物死亡後無法暈眩存活者）
- 新增暈眩視覺效果：灰白色變色 + 停止 Q 彈動畫
- 技術美術大神：1 秒暈眩
- 完美像素審判：1 秒暈眩（新增）

### 視覺效果

#### 完美像素審判配色更新
- 主色改為青綠色（0x66ffcc），與疾光狙擊同色系
- 井字線、爆炸核心、光環、十字閃光統一青綠色
- 分身版爆炸效果同步更新

### Bug 修復

#### 分身輪鋸單位錯誤
- 修正軌道位置計算使用錯誤單位（orbitRadiusWorld → orbitRadiusPx）
- 修正碰撞偵測單位不一致問題

#### 分身技能修正
- 分身技美大神：加入怪物半徑判定、修正暈眩順序
- 分身完美像素：爆炸範圍修正為 3 單位（原 1.5 單位）、加入怪物半徑判定

---

## v0.8.6a - 分身系統修復

### Bug 修復

#### 分身重複移除問題
- 修復 `dismissPhantomById` 中重複呼叫 `splice` 導致分身陣列錯亂的問題
- 分身消失時正確清理輪鋸追蹤狀態

### 視覺效果

#### 分身生成/消失特效
- 使用 LINE 紋理重新設計特效
- 兩階段動畫：
  1. 小正方形光點膨脹到 0.5 單位（150ms）
  2. 向上延展拉長 3 倍、變細、淡出（250ms）
- 生成用亮紫色（0xbb88ff）、消失用暗紫色（0x9966ff）

---

## v0.8.5a - 視覺效果優化與分身修正

### 視覺效果改進

#### LINE 紋理統一
- 技術美術大神光束改用 LINE 紋理（寬度 48px）
- 零信任防禦光束改用 LINE 紋理（閃光 40px、持續 16px）
- 爆發的影視特效導彈與爆炸線改用 LINE 紋理（寬度 32px）
- 次元向量疾劃斬擊線改用 LINE 紋理（寬度 48px，6 倍）
- 完美像素審判井字線改用 LINE 紋理（寬度 16px）
- 幻影分身彈射射線改用 LINE 紋理（寬度 24px）

#### 其他視覺調整
- 技術美術大神 CUT IN 主色改為藍紫色（0x9966ff）
- 零信任八角爆炸改為隨機角度、範圍縮小至 2 單位
- 輪鋸內圈從八角形改為圓形
- 修正 sector_360 紋理載入問題，改用 CIRCLE 紋理

### 幻影迭代模式改進

#### 全局彈射射線
- 彈射射線改為全局計時器（0.5 秒一次）
- 射線在本尊與所有分身之間來回彈射
- 第一個分身出現時啟動，最後一個分身消失時停止

#### 技能升級邏輯修正
- 升級同一技能時不再中斷現有分身、不重置冷卻
- 只有首次取得或切換技能時才會立即觸發
- 冷卻時間從 20 秒改為 15 秒

### 遊戲體驗改進

#### CUT IN 暫停移除
- 選完技能卡後立即恢復遊戲
- CUT IN 動畫期間遊戲繼續運行

---

## v0.8.0a - 標題畫面視覺強化

### 新增功能

#### 標題畫面視覺效果
- 新增 NeroS 角色圖片（右側，150% 畫面高度）
- 新增 Cube 圖片（左側，70% 畫面高度）
- 新增紫色光暈圖片（200% 畫面高度，電流閃爍效果）

#### 動畫效果
- Cube 呼吸縮放動畫（3% 尺寸變化）
- Cube 上下飄動動畫（2% 畫面高度）
- NeroS 呼吸縮放動畫（1.5% 尺寸變化）
- 光暈不規則電流閃爍（隨機縮放、透明度、速度）

### 改進

#### 幻影分身技能
- 分身施放絕對邏輯防禦時產生 3 個輪鋸
- 輪鋸公轉速度為玩家的 2 倍（1 秒一圈）

#### 技術美術大神
- 癱瘓時間從 0.5 秒增加至 1 秒

#### 進階技能 CUT IN
- 進階技能升級時顯示「Lv.X」而非「MAX」

### 視覺調整
- 背景亮度調整為 50%
- NeroS 亮度調整為 75%

---

## v0.7.3a - 幻影迭代模式

### 新增功能

#### 進階技能：幻影迭代模式
- **組合**：咒言幻象（遊戲先知）+ AI 賦能強化
- **冷卻**：15 秒（受冷卻減少影響）
- **效果**：召喚半透明紫色影分身
- **持續時間**：技能等級/5 + 1 秒
- **分身行為**：
  - 每秒施放一個隨機進階技能（燃燒的賽璐珞、技術美術大神、完美像素審判、爆發的影視特效）
  - 施放後以 4 倍速移動到玩家周圍 1~3 單位內的隨機位置
  - 移動時產生殘影效果
- **嘲諷**：怪物會優先攻擊分身而非玩家
- **多分身**：高等級時可能同時存在多個分身

### 改進

#### 進階技能選擇規則
- 已裝備的進階技能必定出現在選項中

---

## v0.7.2a - 進階技能強化與視覺優化

### 新增功能

#### 進階技能：完美像素審判
- **組合**：疾光狙擊（超級導演）+ 視網膜增強模組
- **效果**：每 3 秒繪製井字線，4 個焦點隨機順序爆炸
- **爆炸間隔**：1 秒內完成 4 次爆炸

#### 進階技能：爆發的影視特效
- **組合**：疾光狙擊（超級導演）+ AI 賦能強化
- **效果**：每 3.5 秒發射 20 枚追蹤導彈
- **導彈行為**：隨機方向飛出 2 單位後，直衝最近敵人
- **導彈造型**：細長漸層矩形，俯衝時拉長 3 倍

#### 絕對邏輯防禦：輪鋸飛出
- 護盾重新填充時，剩餘輪鋸向外螺旋飛出
- 飛出時持續繞角色旋轉（1.5 圈）
- 飛行過程中可造成傷害

### 改進

#### 技能選擇面板
- ASD 按鍵提示移至卡片外下方

#### 技術美術大神視覺效果
- 光線從遊戲區頂端落下至目標點
- 更細更銳利的光束（2px 核心 + 4px 光暈）
- 新增殘影淡出效果

---

## v0.7.1a - 進階技能優化

### 新增功能

#### 進階技能：絕對邏輯防禦
- **組合**：靈魂統領（架構師）+ 精神同步率強化
- **效果**：有護盾時產生輪鋸繞角色旋轉
- **輪鋸數量**：滿盾 6 個，按護盾比例減少
- **旋轉速度**：2 秒一圈
- **撞敵消耗**：每隻怪物消耗 2% 最大護盾

### 改進

#### 卡片文字排版優化
- 新增 `CARD_TEXT_PADDING` 常數控制文字邊距
- 文字自動換行不超出卡片邊界
- 電腦版與手機版分開處理字體大小
- 文字過長時自動縮小字體

#### 技能資訊窗格
- 新增「絕對邏輯防禦」資訊顯示（輪鋸數量、旋轉速度、耗盾量、當前護盾）
- 新增「技術美術大神」資訊顯示（傷害、範圍、癱瘓時間、冷卻）

### 修正

#### 進階技能解鎖條件
- 修正進階技能只需持有基礎技能就能解鎖的問題
- 現在需要基礎技能達到 MAX 等級才能解鎖進階技能

---

## v0.7.0a - 進階技能系統

### 新增功能

#### 進階技能系統
- 新增進階技能機制：當持有特定基礎技能組合時，可解鎖進階技能
- 進階技能等級無上限，可持續升級強化
- 技能選擇時，若一般技能選項不足 3 個，會用可解鎖的進階技能填補空位

#### 進階技能：燃燒的賽璐珞
- **組合**：靈魂渲染（動畫大師）+ 鈦金屬賽博肝臟
- **CUT IN**：「你選擇成為傳統手繪動畫師、逐幀動畫師」
- **冷卻**：2 秒
- **效果**：發動時消耗 10 HP，以角色為中心旋轉一圈 30° 扇形攻擊
- **傷害**：（角色等級 + 技能等級）× 傷害單位

#### 進階技能：技術美術大神
- **組合**：咒言幻象（遊戲先知）+ AI 賦能強化
- **CUT IN**：「左手寫 Code，右手畫圖，一人成軍的遊戲開發者」
- **冷卻**：1 秒
- **效果**：每秒在角色周圍 5 單位隨機地點射下光線，產生 3 單位爆炸範圍
- **傷害**：（角色等級 + 技能等級）× 傷害單位
- **特殊**：命中敵人癱瘓 0.5 秒（停止移動和攻擊）

#### 怪物暈眩系統
- 新增怪物暈眩/癱瘓機制
- 暈眩中的怪物停止移動和攻擊
- 支援暈眩時間疊加（取較長的結束時間）

### 技能選擇邏輯調整
- 優先顯示一般技能（2 主動 + 1 被動）
- 若一般技能不足 3 個，用進階技能填充空位
- 混合顯示時，進階技能卡片有金色邊框和「ADVANCED」標籤

---

## v0.6.3a 及更早版本
- 基礎技能系統
- 怪物系統
- 經驗值與等級系統
- HP 與護盾系統
